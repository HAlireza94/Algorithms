SELECT 
    WANDS.ID AS ID,
    WANDS_PROPERTY.AGE AS AGE,
    WANDS.COINS_NEEDED AS CN,
    WANDS.POWER AS P
FROM 
    WANDS
INNER JOIN 
    WANDS_PROPERTY ON WANDS_PROPERTY.CODE = WANDS.CODE
INNER JOIN (SELECT 
            WANDS.POWER,
            WANDS_PROPERTY.AGE,
            MIN(WANDS.COINS_NEEDED) AS MIN_CN
            FROM WANDS
            INNER JOIN WANDS_PROPERTY ON WANDS_PROPERTY.CODE = WANDS.CODE
            WHERE WANDS_PROPERTY.IS_EVIL = 0
            GROUP BY WANDS.POWER, WANDS_PROPERTY.AGE) AS MIN_WANDS ON MIN_WANDS.AGE = WANDS_PROPERTY.AGE AND MIN_WANDS.POWER = WANDS.POWER AND MIN_WANDS.MIN_CN = WANDS.COINS_NEEDED    

WHERE WANDS_PROPERTY.IS_EVIL = 0
ORDER BY P DESC,AGE DESC;
